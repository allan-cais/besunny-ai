# Railway Multi-Service Configuration
# This file explicitly defines both frontend and backend services

# Frontend Service
[[services]]
name = "frontend"
type = "web"

[services.build]
builder = "nixpacks"
buildCommand = "npm install && npm run build:production"
watchPatterns = ["src/**/*", "package.json", "vite.config.ts"]

[services.build.source]
path = "."
exclude = ["backend/**", "supabase/**", "database/**", "docs/**", "*.md", "Dockerfile*", "deploy-*.sh", "**/deno.json", "**/*.deno"]

[services.build.output]
path = "dist"

[services.build.detection]
node = true
python = false
deno = false

[services.deploy]
startCommand = "npx serve -s dist -l $PORT"
healthcheckPath = "/"
healthcheckTimeout = 30

[services.envs]
NODE_ENV = "production"
ENVIRONMENT = "production"
VITE_APP_NAME = "BeSunny.ai"
VITE_APP_VERSION = "17.0.0"
VITE_ENVIRONMENT = "production"
VITE_PYTHON_BACKEND_URL = "https://your-backend-service.railway.app"

# Backend Service
[[services]]
name = "backend"
type = "web"

[services.build]
builder = "nixpacks"
buildCommand = "pip install -r requirements.txt"
watchPatterns = ["**/*.py", "requirements.txt"]

[services.build.source]
path = "."
exclude = ["src/**", "public/**", "package*.json", "vite.config.ts", "tailwind.config.ts", "tsconfig*.json", "*.md", "Dockerfile*", "deploy-*.sh", "node_modules/**", "dist/**", "**/deno.json", "**/*.deno"]

[services.build.detection]
python = true
node = false
deno = false

[services.deploy]
startCommand = "cd backend && python start.py"
healthcheckPath = "/health"
healthcheckTimeout = 300

[services.envs]
PYTHON_VERSION = "3.11"
ENVIRONMENT = "production"
DEBUG = "false"
HOST = "0.0.0.0"
PORT = "$PORT"
WORKERS = "1"
ENABLE_METRICS = "false"
LOG_LEVEL = "INFO"
LOG_FORMAT = "json"
SECRET_KEY = "railway-staging-secret-key-change-in-production"
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = "30"
CORS_ORIGINS = "*"
CORS_ALLOW_CREDENTIALS = "false"
SUPABASE_URL = "https://placeholder.supabase.co"
SUPABASE_SERVICE_ROLE_KEY = "placeholder-key"
SUPABASE_ANON_KEY = "placeholder-key"
REDIS_URL = "redis://localhost:6379/0"
